"use strict";function forceReload(){location.reload(!0)}var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),AIRTABLE="https://api.airtable.com/v0",TOKEN_KEY="$token",AppBar=function(t){var e=t.updateReady?preact.h("a",{class:"upgrade icon",onClick:forceReload},preact.h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},preact.h("path",{d:"M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14zm-1-6h-3V8h-2v5H8l4 4 4-4z"}))):null;return preact.h("header",null,preact.h("span",{class:"title"},"Overcast"),e)},Login=function(t){return preact.h("form",{onSubmit:t.authenticate},preact.h("fieldset",null,preact.h("div",{class:"cell"},preact.h("input",{type:"password",name:"token",required:!0,inputMode:"verbatim",autofocus:!0}),preact.h("label",{for:"token"},"Token")),preact.h("div",{class:"cell"},preact.h("button",{type:"submit"},"Authenticate"))))},Err=function(t){return preact.h("main",{class:"error"},preact.h("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 48 48"},preact.h("path",{d:"M24 4C12.96 4 4 12.95 4 24s8.96 20 20 20 20-8.95 20-20S35.04 4 24 4zm2 30h-4v-4h4v4zm0-8h-4V14h4v12z"})),preact.h("p",null,t.message))},Loading=function(){return preact.h("main",{class:"loading"},preact.h("div",{class:"spinner"}))},ListItem=function(t){var e=t.record;return preact.h("a",{class:"item",href:"#"+e.id},e.fields.Name)},List=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.render=function(t,e){return e.error?preact.h(Err,{message:e.error}):e.characters?preact.h("main",{class:"list"},e.characters.map(function(t){return preact.h(ListItem,{key:t.id,record:t})})):preact.h(Loading,null)},e.prototype.componentWillMount=function(){var t=this,e=AIRTABLE+"/"+this.props.base+"/Characters?fields[]=Name";fetch(e,{headers:{Authorization:"Bearer "+this.props.token}}).then(function(e){return e.json().then(function(n){e.ok?t.setState({characters:n.records}):t.setState({error:n.error.message})})})},e}(preact.Component),App=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={token:e._token()},e._authenticate=function(t){t.preventDefault();var n=t.currentTarget,r=n.querySelector("input");r&&(localStorage.setItem(TOKEN_KEY,r.value),e._setToken())},e._setToken=function(){e.setState({token:e._token()})},e._onUpdateReady=function(){e.setState({updateReady:applicationCache.status===applicationCache.UPDATEREADY})},e}return __extends(e,t),e.prototype.render=function(){return preact.h("div",{class:"app"},preact.h(AppBar,{updateReady:this.state.updateReady}),this._main())},e.prototype.componentWillMount=function(){applicationCache.addEventListener("updateready",this._onUpdateReady),window.addEventListener("storage",this._setToken)},e.prototype.componentWillUnmount=function(){applicationCache.removeEventListener("updateready",this._onUpdateReady),window.removeEventListener("storage",this._setToken)},e.prototype._base=function(){return this.props.query.base||null},e.prototype._token=function(){return localStorage.getItem(TOKEN_KEY)},e.prototype._main=function(){var t=this._base(),e=this.state.token;return null===e?preact.h(Login,{authenticate:this._authenticate}):null===t?preact.h(Err,{message:"Base is required in querystring"}):preact.h(List,{base:t,token:e})},e}(preact.Component);window.addEventListener("load",function(){var t=window.location.search.substring(1).split("&").reduce(function(t,e){var n=e.split("=");return t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]),t},{});preact.render(preact.h(App,{query:t}),document.body)});
//# sourceMappingURL=dist/6d4fea3592b3fbceca0163bc.map